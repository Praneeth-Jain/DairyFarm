@page
@model DairyFarm.Pages.Cattle.CattleViewModel
@{
    ViewData["Title"] = "Cow View";
}

<div class="cattleview-container">
    <div class="cattleview-left">
        <h3>Cow List</h3>
        <ul class="cattleview-cow-list">
            @foreach (var cow in Model.Cows)
            {
                <li>
                    <button class="cattleview-cow-item" data-cow-id="@cow.CowId">@cow.CowName</button>
                </li>
            }
        </ul>
    </div>

    <!-- Right Upper Div: Cow Details -->
    <div class="cattleview-right-upper">
        <h3>Cow Details</h3>
        <div id="cattleview-details-content">
            <!-- Cow details will be loaded dynamically -->
        </div>
    </div>

    <!-- Right Lower Div: Forms -->
    <div class="cattleview-right-lower">
        <div class="cattleview-buttons">
            <button id="cattleview-add-feed-btn" class="cattleview-action-btn">Add Feed Details</button>
            <button id="cattleview-add-milk-btn" class="cattleview-action-btn">Add Milk Production</button>
        </div>
        <div id="cattleview-form-content">
            <!-- Forms will be loaded dynamically -->
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Load cow details when a cow is clicked
            $(".cattleview-cow-item").on("click", function () {
                const cowId = $(this).data("cow-id");
                console.log(cowId)
                // Highlight the selected cow
                $(".cattleview-cow-item").removeClass("active");
                $(this).addClass("active");

                // Load cow details in the upper right div
                $.ajax({
                    url: `@Url.Page("CattleView", new { handler = "CowDetails" })&id=` + cowId,
                    type: "GET",
                    success: function (data) {
                        $("#cattleview-details-content").html(data);
                    },
                    error: function () {
                        alert("Failed to load cow details.");
                    }
                });

                // Clear lower-right div
                $("#cattleview-form-content").empty();
            });

            // Load feed form
            $("#cattleview-add-feed-btn").on("click", function () {
                const cowId = $(".cattleview-cow-item.active").data("cow-id");

                if (!cowId) {
                    alert("Please select a cow first.");
                    return;
                }

                $.ajax({
                    url: `/Cattle/CattleView?handler=FeedForm&cowId=${cowId}`,
                    type: "GET",
                    success: function (data) {
                        $("#cattleview-form-content").html(data);
                    },
                    error: function () {
                        alert("Failed to load feed form.");
                    }
                });
            });

            // Load milk production form
            $("#cattleview-add-milk-btn").on("click", function () {
                const cowId = $(".cattleview-cow-item.active").data("cow-id");

                if (!cowId) {
                    alert("Please select a cow first.");
                    return;
                }

                $.ajax({
                    url: `/Cattle/CattleView?handler=MilkProductionForm&cowId=${cowId}`,
                    type: "GET",
                    success: function (data) {
                        $("#cattleview-form-content").html(data);
                    },
                    error: function () {
                        alert("Failed to load milk production form.");
                    }
                });
            });


           
      

            // Submit Milk Production Form
            $(document).on("submit", "#milk-form", function (e) {
                e.preventDefault(); // Prevent form from refreshing the page

            const formData = {
                CowId: $("#CowId").val(),
            ProductionDate: $("#ProductionDate").val(),
            Quantity: $("#Quantity").val(),
            Notes: $("#Notes").val(),
                };

            $.ajax({
                url: `/Cattle/CattleView?handler=SubmitMilk`,
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function () {
                alert("Milk production added successfully.");
            $("#cow-forms").empty(); // Clear the form
                    },
            error: function () {
                alert("Failed to submit milk production.");
                    }
                });
            });
        });
    </script>


}
